---
title: "Sala de Situação - COVID-19 PE"
output:
   flexdashboard::flex_dashboard:
    # orientation: rows
    vertical_layout: scroll
    theme: lumen
runtime: shiny
---

```{r setup, echo=FALSE}
knitr::opts_chunk$set(error = TRUE)
library(flexdashboard)
library(shiny)
source('./scripts/global.R')
source('./scripts/macrogeres.R')
source('./scripts/geres.R')
source('./scripts/municipios.R')
source('./scripts/analises.R')
source('./scripts/r_efetivo.R')
```

Epidemiologia {data-icon="fa-chart-line" data-orientation=rows}
===================================== 

Row
-------------------------------------

### `r valueBox(value =  tags$p('Casos | Óbitos', style = "font-size: 125%;"))`

```{r epi pernambuco}
valueBox('Pernambuco', color = 'blue')
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Casos COVID19-SRAG', style = "font-size: 125%;"))`

```{r epi casoscovid19pe}
valueBox( format( sum( srag_pernambuco$CONFIRMADO), big.mark="." ), color = 'blue', icon = "fa-virus")
```

### `r valueBox(value =  tags$p('Casos SRAG', style = "font-size: 125%;"))`

```{r epi casossragpe}
valueBox(format ( sum(srag_pernambuco$SRAG), big.mark="." ), color = 'blue', icon = "fa-virus")
```

### `r valueBox(value =  tags$p('Óbitos COVID19', style = "font-size: 125%;"))`

```{r epi obitoscovid19pe}
valueBox( format( sum(obitos_pernambuco$CONFIRMADO), big.mark="." ), color = 'blue', icon = "fa-virus")
```

### `r valueBox(value =  tags$p('Óbitos SRAG', style = "font-size: 125%;"))`

```{r epi obitossragpe}
valueBox( format( sum(obitos_pernambuco$SRAG), big.mark="." ), color = 'blue', icon = "fa-virus")
```

Row {data-height=30}
-------------------------------------

* Para mais informações sobre o Calendário Epidemiológico 2020, acesse http://portalsinan.saude.gov.br/calendario-epidemiologico

Row
-------------------------------------

### `r valueBox(value =  tags$p('Casos Pernambuco', style = "font-size: 115%; font-weight: bold;"))`

```{r epi resultados casos}

shiny::radioButtons(inputId = 'radio1', 'Visualizacao dos Dados', c('Data do Fato', 'Semana Epidemiologica'), inline = T)

 srag_semana_pe <- srag_pernambuco %>% group_by(semana) %>% summarise(CONFIRMADO = sum(CONFIRMADO), SRAG = sum(SRAG))

 renderPlotly({
 if(input$radio1 == "Data do Fato") {
   
    m <- subset(srag_pernambuco, data == max(srag_pernambuco$data)-5)
   
plotly::plot_ly(data = srag_pernambuco) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(sragfMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Srag",
    line = list(color = 'rgb(22, 96, 167)', dash = 'dash'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
   add_trace(
    x = ~data,
    y = ~ceiling(SRAG),
    type = 'bar', 
    name = 'Srag',
    line = list(color = 'white'),
    marker = list(color = 'rgb(22, 96, 167)')
  ) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(confMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Covid",
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', 
    name = 'Covid',
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash')
  )  %>%
  add_annotations(x = m$data,
  y = m$sragfMM7,
  text = 'Data base de Analise',
  xref = "x",
  yref = "y",
  showarrow = TRUE,
  arrowhead = 7,
  ax = 40,
  ay = -80) %>%
  plotly::layout(
    height = '380',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
  }

  else {
  plotly::plot_ly(data = srag_semana_pe) %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(SRAG),
    type = 'bar', mode = 'lines',
    name = "SRAG",
    line = list(color = 'rgb(22, 96, 167)'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', mode = 'lines',
    name = "COVID",
    line = list(color = 'rgb(205, 12, 24)'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  plotly::layout(
    height = '380',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  ) 
  }
})
```


Row
-------------------------------------

### `r valueBox(value =  tags$p('Óbitos Pernambuco', style = "font-size: 115%; font-weight: bold;"))`

```{r epi resultados obitos}

shiny::radioButtons(inputId = 'radio2', 'Visualizacao dos Dados', c('Data do Fato', 'Semana Epidemiologica'), inline = T)

 obitos_semana_pe <- obitos_pernambuco %>% group_by(semana) %>% summarise(CONFIRMADO = sum(CONFIRMADO), SRAG = sum(SRAG))

 renderPlotly({
 if(input$radio2 == "Data do Fato") {
   
    m <- subset(obitos_pernambuco, data == max(obitos_pernambuco$data)-5)
   
plotly::plot_ly(data = obitos_pernambuco) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(sragfMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Srag",
    line = list(color = 'rgb(22, 96, 167)', dash = 'dash'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
   add_trace(
    x = ~data,
    y = ~ceiling(SRAG),
    type = 'bar', 
    name = 'Srag',
    line = list(color = 'white'),
    marker = list(color = 'rgb(22, 96, 167)')
  ) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(confMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Covid",
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', 
    name = 'Covid',
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash')
  )  %>%
  add_annotations(x = m$data,
  y = m$sragfMM7,
  text = 'Data base de Analise',
  xref = "x",
  yref = "y",
  showarrow = TRUE,
  arrowhead = 7,
  ax = 40,
  ay = -80) %>%
  plotly::layout(
    height = '380',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
  }

  else {
  plotly::plot_ly(data = obitos_semana_pe) %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(SRAG),
    type = 'bar', mode = 'lines',
    name = "SRAG",
    line = list(color = 'rgb(22, 96, 167)'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', mode = 'lines',
    name = "COVID",
    line = list(color = 'rgb(205, 12, 24)'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  plotly::layout(
    height = '380',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  ) 
  }
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Casos | Obitos', style = "font-size: 125%;"))`

```{r epi macrorregiao}
valueBox('Macrorregião', color = 'blue')
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Casos Macrorregião', style = "font-size: 115%; font-weight: bold;"))`

```{r casos macrorregiao}

shiny::radioButtons(inputId = 'radio3', 'Visualizacao dos Dados', c('Data do Fato', 'Semana Epidemiologica'), inline = T)

selectizeInput('macro_casos', 'Macrorregiao', choices = sort(as.character(unique(srag_macro$macro))), selected = 'I - METROPOLITANA')

renderPlotly({

  if(input$radio3 == "Data do Fato") {
  
  x <- srag_macro %>% filter(macro==input$macro_casos)
  
  m <- subset(x, data == max(x$data)-5)

plotly::plot_ly(data = x) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(sragfMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Srag",
    line = list(color = 'rgb(22, 96, 167)', dash = 'dash'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
   add_trace(
    x = ~data,
    y = ~ceiling(SRAG),
    type = 'bar', 
    name = 'Srag',
    line = list(color = 'white'),
    marker = list(color = 'rgb(22, 96, 167)')
  ) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(confMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Covid",
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', 
    name = 'Covid',
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash')
  )  %>%
  add_annotations(x = m$data,
  y = m$sragfMM7,
  text = 'Data base de Analise',
  xref = "x",
  yref = "y",
  showarrow = TRUE,
  arrowhead = 7,
  ax = 40,
  ay = -80) %>%
  plotly::layout(
    height = '320',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
  }
  
  else {
  srag_semana_macro <- srag_macro %>% filter(macro==input$macro_casos) %>% group_by(semana) %>% summarise(CONFIRMADO = sum(CONFIRMADO), SRAG = sum(SRAG))

plotly::plot_ly(data = srag_semana_macro) %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(SRAG),
    type = 'bar', mode = 'lines',
    name = "SRAG",
    line = list(color = 'rgb(22, 96, 167)'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', mode = 'lines',
    name = "COVID",
    line = list(color = 'rgb(205, 12, 24)'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  plotly::layout(
    height = '320',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
  
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Óbitos Macrorregião', style = "font-size: 115%; font-weight: bold;"))`

```{r obitos macrorregiao}

shiny::radioButtons(inputId = 'radio4', 'Visualizacao dos Dados', c('Data do Fato', 'Semana Epidemiologica'), inline = T)

selectizeInput('macro_obitos', 'Macrorregiao', choices = sort(as.character(unique(obitos_macro$macro))), selected = 'I - METROPOLITANA')

renderPlotly({

  if(input$radio4 == "Data do Fato") {
  
  x <- obitos_macro %>% filter(macro==input$macro_obitos)
  
  m <- subset(x, data == max(x$data)-5)

plotly::plot_ly(data = x) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(sragfMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Srag",
    line = list(color = 'rgb(22, 96, 167)', dash = 'dash'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
   add_trace(
    x = ~data,
    y = ~ceiling(SRAG),
    type = 'bar', 
    name = 'Srag',
    line = list(color = 'white'),
    marker = list(color = 'rgb(22, 96, 167)')
  ) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(confMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Covid",
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', 
    name = 'Covid',
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash')
  )  %>%
  add_annotations(x = m$data,
  y = m$sragfMM7,
  text = 'Data base de Analise',
  xref = "x",
  yref = "y",
  showarrow = TRUE,
  arrowhead = 7,
  ax = 40,
  ay = -80) %>%
  plotly::layout(
    height = '320',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
  }
  
  else {
  obito_semana_macro <- obitos_macro %>% filter(macro==input$macro_obitos) %>% group_by(semana) %>% summarise(CONFIRMADO = sum(CONFIRMADO), SRAG = sum(SRAG))

plotly::plot_ly(data = obito_semana_macro) %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(SRAG),
    type = 'bar', mode = 'lines',
    name = "SRAG",
    line = list(color = 'rgb(22, 96, 167)'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', mode = 'lines',
    name = "COVID",
    line = list(color = 'rgb(205, 12, 24)'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  plotly::layout(
    height = '320',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
  
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Casos | Óbitos', style = "font-size: 125%;"))`

```{r epi geres}
valueBox('Geres', color = 'blue')
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Casos Geres', style = "font-size: 115%; font-weight: bold;"))`

```{r casos geres}

shiny::radioButtons(inputId = 'radioEpi5', 'Visualizacao dos Dados', c('Data do Fato', 'Semana Epidemiologica'), inline = T)

selectizeInput('geres_casos', 'Geres', choices = sort(as.character(unique(srag_geres$geres))), selected = 'I GERES')

renderPlotly({

  if(input$radioEpi5 == "Data do Fato") {
  
  x <- srag_geres %>% filter(geres==input$geres_casos)
  
  m <- subset(x, data == max(x$data)-5)

plotly::plot_ly(data = x) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(sragfMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Srag",
    line = list(color = 'rgb(22, 96, 167)', dash = 'dash'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
   add_trace(
    x = ~data,
    y = ~ceiling(SRAG),
    type = 'bar', 
    name = 'Srag',
    line = list(color = 'white'),
    marker = list(color = 'rgb(22, 96, 167)')
  ) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(confMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Covid",
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', 
    name = 'Covid',
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash')
  )  %>%
  add_annotations(x = m$data,
  y = m$sragfMM7,
  text = 'Data base de Analise',
  xref = "x",
  yref = "y",
  showarrow = TRUE,
  arrowhead = 7,
  ax = 40,
  ay = -80) %>%
  plotly::layout(
    height = '320',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
  }
  
  else {
  srag_semana_geres <- srag_geres %>% filter(geres==input$geres_casos) %>% group_by(semana) %>% summarise(CONFIRMADO = sum(CONFIRMADO), SRAG = sum(SRAG))

plotly::plot_ly(data = srag_semana_geres) %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(SRAG),
    type = 'bar', mode = 'lines',
    name = "SRAG",
    line = list(color = 'rgb(22, 96, 167)'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', mode = 'lines',
    name = "COVID",
    line = list(color = 'rgb(205, 12, 24)'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  plotly::layout(
    height = '320',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
  
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Óbitos Geres', style = "font-size: 115%; font-weight: bold;"))`

```{r obitos geres}

shiny::radioButtons(inputId = 'radioEpi6', 'Visualizacao dos Dados', c('Data do Fato', 'Semana Epidemiologica'), inline = T)

selectizeInput('geres_obitos', 'Geres', choices = sort(as.character(unique(obitos_geres$geres))), selected = 'I GERES')

renderPlotly({

  if(input$radioEpi6 == "Data do Fato") {
  
  x <- obitos_geres %>% filter(geres==input$geres_obitos)
  
  m <- subset(x, data == max(x$data)-5)

plotly::plot_ly(data = x) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(sragfMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Srag",
    line = list(color = 'rgb(22, 96, 167)', dash = 'dash'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
   add_trace(
    x = ~data,
    y = ~ceiling(SRAG),
    type = 'bar', 
    name = 'Srag',
    line = list(color = 'white'),
    marker = list(color = 'rgb(22, 96, 167)')
  ) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(confMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Covid",
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', 
    name = 'Covid',
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash')
  )  %>%
  add_annotations(x = m$data,
  y = m$sragfMM7,
  text = 'Data base de Analise',
  xref = "x",
  yref = "y",
  showarrow = TRUE,
  arrowhead = 7,
  ax = 40,
  ay = -80) %>%
  plotly::layout(
    height = '320',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
  }
  
  else {
  obito_semana_geres <- obitos_geres %>% filter(geres==input$geres_obitos) %>% group_by(semana) %>% summarise(CONFIRMADO = sum(CONFIRMADO), SRAG = sum(SRAG))

plotly::plot_ly(data = obito_semana_geres) %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(SRAG),
    type = 'bar', mode = 'lines',
    name = "SRAG",
    line = list(color = 'rgb(22, 96, 167)'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', mode = 'lines',
    name = "COVID",
    line = list(color = 'rgb(205, 12, 24)'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  plotly::layout(
    height = '320',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
  
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Casos | Óbitos', style = "font-size: 125%;"))`

```{r epi municipio}
valueBox('Município', color = 'blue')
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Casos Município', style = "font-size: 115%; font-weight: bold;"))`

```{r casos municipio}

shiny::radioButtons(inputId = 'radioEpi7', 'Visualizacao dos Dados', c('Data do Fato', 'Semana Epidemiologica'), inline = T)

selectizeInput('municipio_casos', 'Municipio', choices = sort(as.character(unique(srag_municipio_gb$municipio))), selected = 'RECIFE')

renderPlotly({

  if(input$radioEpi7 == "Data do Fato") {
  
  x <- srag_municipio_gb %>% filter(municipio==input$municipio_casos)
  
  m <- subset(x, data == max(x$data)-5)

plotly::plot_ly(data = x) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(sragfMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Srag",
    line = list(color = 'rgb(22, 96, 167)', dash = 'dash'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
   add_trace(
    x = ~data,
    y = ~ceiling(SRAG),
    type = 'bar', 
    name = 'Srag',
    line = list(color = 'white'),
    marker = list(color = 'rgb(22, 96, 167)')
  ) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(confMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Covid",
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', 
    name = 'Covid',
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash')
  )  %>%
  add_annotations(x = m$data,
  y = m$sragfMM7,
  text = 'Data base de Analise',
  xref = "x",
  yref = "y",
  showarrow = TRUE,
  arrowhead = 7,
  ax = 40,
  ay = -80) %>%
  plotly::layout(
    height = '320',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
  }
  
  else {
  srag_semana_municipio <- srag_municipio_gb %>% filter(municipio==input$municipio_casos) %>% group_by(semana) %>% summarise(CONFIRMADO = sum(CONFIRMADO), SRAG = sum(SRAG))

plotly::plot_ly(data = srag_semana_municipio) %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(SRAG),
    type = 'bar', mode = 'lines',
    name = "SRAG",
    line = list(color = 'rgb(22, 96, 167)'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', mode = 'lines',
    name = "COVID",
    line = list(color = 'rgb(205, 12, 24)'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  plotly::layout(
    height = '320',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
  
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Óbitos Município', style = "font-size: 115%; font-weight: bold;"))`

```{r obitos municipio}

shiny::radioButtons(inputId = 'radioEpi8', 'Visualizacao dos Dados', c('Data do Fato', 'Semana Epidemiologica'), inline = T)

selectizeInput('municipio_obitos', 'Municipio', choices = sort(as.character(unique(obitos_municipio_gb$municipio))), selected = 'RECIFE')

renderPlotly({

  if(input$radioEpi8 == "Data do Fato") {
  
  x <- obitos_municipio_gb %>% filter(municipio==input$municipio_obitos)
  
  m <- subset(x, data == max(x$data)-5)

plotly::plot_ly(data = x) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(sragfMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Srag",
    line = list(color = 'rgb(22, 96, 167)', dash = 'dash'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
   add_trace(
    x = ~data,
    y = ~ceiling(SRAG),
    type = 'bar', 
    name = 'Srag',
    line = list(color = 'white'),
    marker = list(color = 'rgb(22, 96, 167)')
  ) %>%
  add_trace(
    x = ~data,
    y = ~ceiling(confMM7),
    type = 'scatter', mode = 'lines',
    name = "MM7 - Covid",
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', 
    name = 'Covid',
    line = list(color = 'rgb(205, 12, 24)', dash = 'dash')
  )  %>%
  add_annotations(x = m$data,
  y = m$sragfMM7,
  text = 'Data base de Analise',
  xref = "x",
  yref = "y",
  showarrow = TRUE,
  arrowhead = 7,
  ax = 40,
  ay = -80) %>%
  plotly::layout(
    height = '320',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
  }
  
  else {
  obitos_semana_municipio <- obitos_municipio_gb %>% filter(municipio==input$municipio_obitos) %>% group_by(semana) %>% summarise(CONFIRMADO = sum(CONFIRMADO), SRAG = sum(SRAG))

plotly::plot_ly(data = obitos_semana_municipio) %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(SRAG),
    type = 'bar', mode = 'lines',
    name = "SRAG",
    line = list(color = 'rgb(22, 96, 167)'),
    marker = list(color = 'rgb(22, 96, 167)')
  )  %>%
  add_trace(
    x = ~semana,
    y = ~ceiling(CONFIRMADO),
    type = 'bar', mode = 'lines',
    name = "COVID",
    line = list(color = 'rgb(205, 12, 24)'),
    marker = list(color = 'rgb(205, 12, 24)')
  )  %>%
  plotly::layout(
    height = '320',
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
  
})
```

Sistema de Saúde {data-icon="fa-chart-bar" data-orientation=rows}
===================================== 

Row
-------------------------------------

### `r valueBox(value =  tags$p('Solicitações | Leitos', style = "font-size: 125%;"))`

```{r sist saude pernambuco}
valueBox('Pernambuco', color = 'orange')
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Indicadores de Solicitações - Média Móvel 7 Dias (MM7)', style = "font-size: 125%; font-weight: bold;"))`

```{r sis saude solicitacoes pernambuco}

shiny::radioButtons(inputId = 'radio5', 'Indicador', c('Solicitacoes', 'Fila', 'Fila Nova'), inline = T)

renderPlotly({
 
  if (input$radio5 != "Fila Nova") {
    if (input$radio5 == "Solicitacoes") {
plotly::plot_ly(data = solicitacoes_pernambuco) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(geralMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(utiMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(enfMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 400, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
else {
plotly::plot_ly(data = fila_total_pernambuco) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(geralMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
    plotly::add_trace(
    x = ~data,
    y = ~ceiling(utiMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(enfMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 400, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
  }
else {
  plotly::plot_ly(data = fila_nova_pernambuco) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(geralMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(utiMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(enfMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 400, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Indicadores de Leitos - Média Móvel 7 Dias (MM7)', style = "font-size: 125%; font-weight: bold;"))`

```{r sis saude internacoes pernambuco}

shiny::radioButtons(inputId = 'radio6', 'Indicador', c('Leitos', 'Ocupacao', 'Internacao'), inline = T)

renderPlotly({
 
  if (input$radio6 != "Internacao") {
    if (input$radio6 == "Leitos") {
plotly::plot_ly(data = leitos_pernambuco) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(totalGERALMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(totalUTIMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(totalENFMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 400, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
else {
plotly::plot_ly(data = leitos_pernambuco) %>%
  plotly::add_trace(
    x = ~data,
    y = ~txTOTALMM7,
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
    plotly::add_trace(
    x = ~data,
    y = ~txUTIMM7,
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~txENFMM7,
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 400, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
  }
else {
  plotly::plot_ly(data = internacoes_pernambuco) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(intGLMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(intUTIMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(intENFMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 400, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Solicitações | Leitos', style = "font-size: 125%;"))`

```{r sist saude macro}
valueBox('Macrorregião', color = 'orange')
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Indicadores de Solicitações - Média Móvel 7 Dias (MM7)', style = "font-size: 125%; font-weight: bold;"))`

```{r sis saude solicitacoes macrorregiao}

shiny::radioButtons(inputId = 'radioSS3', 'Indicador', c('Solicitacoes', 'Fila', 'Fila Nova'), inline = T)

selectizeInput('macro_solicitacoes', 'Macrorregiao', choices = sort(as.character(unique(solicitacoes_macro$macro))), selected = 'I - METROPOLITANA')

renderPlotly({
 
  x <- solicitacoes_macro %>% filter(macro == input$macro_solicitacoes)
  y <- fila_total_macro %>% filter(macro == input$macro_solicitacoes)
  z <- fila_nova_macro %>% filter(macro == input$macro_solicitacoes)
  
  if (input$radioSS3 != "Fila Nova") {
    if (input$radioSS3 == "Solicitacoes") {
plotly::plot_ly(data = x) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(geralMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(utiMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(enfMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
else {
plotly::plot_ly(data = y) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(geralMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
    plotly::add_trace(
    x = ~data,
    y = ~ceiling(utiMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(enfMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
  }
else {
  plotly::plot_ly(data = z) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(geralMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(utiMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(enfMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Indicadores de Leitos - Média Móvel 7 Dias (MM7)', style = "font-size: 125%; font-weight: bold;"))`

```{r sis saude internacoes macro}

shiny::radioButtons(inputId = 'radioSS4', 'Indicador', c('Leitos', 'Ocupacao', 'Internacao'), inline = T)

selectizeInput('macro_internacoes', 'Macrorregiao', choices = sort(as.character(unique(solicitacoes_macro$macro))), selected = 'I - METROPOLITANA')

renderPlotly({
 
  x <- leitos_macrogeres %>% filter(macrogeres == input$macro_internacoes)
  y <- internacoes_macro %>% filter(macro == input$macro_internacoes)
  
  if (input$radioSS4 != "Internacao") {
    if (input$radioSS4 == "Leitos") {
plotly::plot_ly(data = x) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(totalGERALMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(totalUTIMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(totalENFMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
else {
plotly::plot_ly(data = x) %>%
  plotly::add_trace(
    x = ~data,
    y = ~txTOTALMM7,
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
    plotly::add_trace(
    x = ~data,
    y = ~txUTIMM7,
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~txENFMM7,
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
  }
else {
  plotly::plot_ly(data = y) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(intGLMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(intUTIMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(intENFMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Solicitações | Leitos', style = "font-size: 125%;"))`

```{r sist saude geres}
valueBox('Geres', color = 'orange')
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Indicadores de Solicitações - Média Móvel 7 Dias (MM7)', style = "font-size: 125%; font-weight: bold;"))`

```{r sis saude solicitacoes geres}

shiny::radioButtons(inputId = 'radioSS5', 'Indicador', c('Solicitacoes', 'Fila', 'Fila Nova'), inline = T)

selectizeInput('geres_solicitacoes', 'Geres', choices = sort(as.character(unique(solicitacoes_geres$geres))), selected = 'I GERES')

renderPlotly({
 
  x <- solicitacoes_geres %>% filter(geres == input$geres_solicitacoes)
  y <- fila_total_geres %>% filter(geres == input$geres_solicitacoes)
  z <- fila_nova_geres %>% filter(geres == input$geres_solicitacoes)
  
  if (input$radioSS5 != "Fila Nova") {
    if (input$radioSS5 == "Solicitacoes") {
plotly::plot_ly(data = x) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(geralMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(utiMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(enfMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
else {
plotly::plot_ly(data = y) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(geralMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
    plotly::add_trace(
    x = ~data,
    y = ~ceiling(utiMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(enfMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
  }
else {
  plotly::plot_ly(data = z) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(geralMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(utiMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(enfMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Indicadores de Leitos - Média Móvel 7 Dias (MM7)', style = "font-size: 125%; font-weight: bold;"))`

```{r sis saude internacoes geres}

shiny::radioButtons(inputId = 'radioSS6', 'Indicador', c('Leitos', 'Ocupacao', 'Internacao'), inline = T)

selectizeInput('geres_internacoes', 'Geres', choices = sort(as.character(unique(internacoes_geres$geres))), selected = 'I GERES')

renderPlotly({
 
  x <- leitos_geres %>% filter(geres == input$geres_internacoes)
  y <- internacoes_geres %>% filter(geres == input$geres_internacoes)
  
  if (input$radioSS6 != "Internacao") {
    if (input$radioSS6 == "Leitos") {
plotly::plot_ly(data = x) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(totalGERALMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(totalUTIMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(totalENFMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
else {
plotly::plot_ly(data = x) %>%
  plotly::add_trace(
    x = ~data,
    y = ~txTOTALMM7,
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
    plotly::add_trace(
    x = ~data,
    y = ~txUTIMM7,
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~txENFMM7,
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
  }
else {
  plotly::plot_ly(data = y) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(intGLMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(intUTIMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(intENFMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Solicitações | Leitos', style = "font-size: 125%;"))`

```{r sist saude municipio}
valueBox('Município', color = 'orange')
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Indicadores de Solicitações - Média Móvel 7 Dias (MM7)', style = "font-size: 125%; font-weight: bold;"))`

```{r sis saude solicitacoes municipio}

shiny::radioButtons(inputId = 'radioSS7', 'Indicador', c('Solicitacoes', 'Fila', 'Fila Nova'), inline = T)

selectizeInput('municipio_solicitacoes', 'Municipio', choices = sort(as.character(unique(solicitacoes_municipio_gb$municipio))), selected = 'RECIFE')

renderPlotly({
 
  x <- solicitacoes_municipio_gb %>% filter(municipio == input$municipio_solicitacoes)
  y <- fila_total_municipio_gb %>% filter(municipio == input$municipio_solicitacoes)
  z <- fila_nova_municipio_gb %>% filter(municipio == input$municipio_solicitacoes)
  
  if (input$radioSS7 != "Fila Nova") {
    if (input$radioSS7 == "Solicitacoes") {
plotly::plot_ly(data = x) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(geralMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(utiMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(enfMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
else {
plotly::plot_ly(data = y) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(geralMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
    plotly::add_trace(
    x = ~data,
    y = ~ceiling(utiMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(enfMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
  }
else {
  plotly::plot_ly(data = z) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(geralMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(utiMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(enfMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Indicadores de Leitos - Média Móvel 7 Dias (MM7)', style = "font-size: 125%; font-weight: bold;"))`

```{r sis saude internacoes municipio}

shiny::radioButtons(inputId = 'radioSS8', 'Indicador', c('Leitos', 'Ocupacao', 'Internacao'), inline = T)

selectizeInput('municipio_internacoes', 'Municipio', choices = sort(as.character(unique(internacoes_municipio$municipio))), selected = 'RECIFE')

renderPlotly({
 
  x <- municipios_leitos %>% filter(municipio == input$municipio_internacoes)
  y <- internacoes_municipio %>% filter(municipio == input$municipio_internacoes)
  
  if (input$radioSS8 != "Internacao") {
    if (input$radioSS8 == "Leitos") {
plotly::plot_ly(data = x) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(totalGERALMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(totalUTIMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(totalENFMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
    }
else {
plotly::plot_ly(data = x) %>%
  plotly::add_trace(
    x = ~data,
    y = ~txTOTALMM7,
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
    plotly::add_trace(
    x = ~data,
    y = ~txUTIMM7,
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~txENFMM7,
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
  }
else {
  plotly::plot_ly(data = y) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(intGLMM7),
    type = 'bar',
    textposition = 'outside',
    name = "Total",
    line = list(color = "orange"),
    marker = list(color = "orange")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(intUTIMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "UTI",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(intENFMM7),
    type = 'scatter', mode = 'lines',
    textposition = 'outside',
    name = "ENFERMARIA",
    line = list(color = "blue"),
    marker = list(color = "blue")
  ) %>%
  plotly::layout(
    height = 350, 
    yaxis = list(title = ""),
    xaxis = list(title = ""),
    hovermode = "compare"
  )
}
})
```

Análises {data-icon="fa-diagnoses" data-orientation=rows}
===================================== 

Row
-------------------------------------

### `r valueBox(value =  tags$p('Predições | R0 (Número Básico de Reprodução) | Rt (Número Reprodutivo Efetivo)', style = "font-size: 115%;"))`

```{r}
valueBox('Pernambuco', color = 'purple')
```

Row
-------------------------------------

### `r valueBox(value =  tags$p(paste('Modelagens Matematicas - Casos', ''), style = "font-size: 125%; font-weight: bold;"))`

```{r}

shiny::radioButtons(inputId = 'radioAn1', 'Modelo', c('Casos Totais', 'Casos por Milhao', 'Rt'), inline = T)

renderPlotly({

  if (input$radioAn1 != "Rt") {
    if (input$radioAn1 == "Casos Totais") {
plotly::plot_ly(data = pred_ll) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(predicao),
    type = 'scatter', mode = 'lines',
    name = "Predição",
    line = list(color = "blue"),
    marker = list(color = "blue")
  )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(confirmados),
    type = 'scatter', mode = 'lines',
    name = "Real",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::layout(
    height = '380',
    yaxis = list(title = "Casos Confirmados"),
    xaxis = list(title = "Data do Boletim"),
    hovermode = "compare"
  )
    }
else {
  plotly::plot_ly(data = pred_ll) %>%
  add_trace(
    x = ~data,
    y = ceiling(espanhaCasosMilhao),
    type = 'scatter', mode = 'lines',
    name = "Espanha",
    line = list(color = "comsilk", dash = 'dash')
    )  %>%
  add_trace(
    x = ~data,
    y = ceiling(belgicaCasosMilhao),
    type = 'scatter', mode = 'lines',
    name = "Bélgica",
    line = list(color = "purple", dash = 'dash')
    )  %>%
  add_trace(
    x = ~data,
    y = ceiling(brasilCasosMilhao),
    type = 'scatter', mode = 'lines',
    name = "Brasil",
    line = list(color = "cyan", dash = 'dash')
    )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(predicao/9.55),
    type = 'scatter', mode = 'lines',
    name = "Predição",
    line = list(color = "blue"),
    marker = list(color = "blue")
  )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(confirmados/9.55),
    type = 'scatter', mode = 'markers',
    name = "Real",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::layout(
    height = '380',
    yaxis = list(title = "Casos Confirmados por Milhão de Habitantes"),
    xaxis = list(title = "Data do Boletim"),
    hovermode = "compare"
  )
}
  }
else {
  fig
}
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p(paste('Modelagens Matemáticas - Óbitos', ''), style = "font-size: 125%; font-weight: bold;"))`

```{r}

shiny::radioButtons(inputId = 'radioAn2', 'Modelo', c('Obitos Totais', 'Obitos por Milhao'), inline = T)

renderPlotly({

  if (input$radioAn2 == "Obitos Totais") {
plotly::plot_ly(data = pred_ll) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(predicaoOb),
    type = 'scatter', mode = 'lines',
    name = "Predição",
    line = list(color = "blue"),
    marker = list(color = "blue")
  )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(obitos),
    type = 'scatter', mode = 'lines',
    name = "Real",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::layout(
    height = '380',
    yaxis = list(title = "Óbitos Confirmados"),
    xaxis = list(title = "Data do Boletim"),
    hovermode = "compare"
  )
    }
else {
  plotly::plot_ly(data = pred_ll) %>%
  add_trace(
    x = ~data,
    y = ceiling(espanhaMortesMilhao),
    type = 'scatter', mode = 'lines',
    name = "Espanha",
    line = list(color = "comsilk", dash = 'dash')
    )  %>%
  add_trace(
    x = ~data,
    y = ceiling(belgicaMortesMilhao),
    type = 'scatter', mode = 'lines',
    name = "Bélgica",
    line = list(color = "purple", dash = 'dash')
    )  %>%
  add_trace(
    x = ~data,
    y = ceiling(brasilMortesMilhao),
    type = 'scatter', mode = 'lines',
    name = "Brasil",
    line = list(color = "cyan", dash = 'dash')
    )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(predicaoOb/9.55),
    type = 'scatter', mode = 'lines',
    name = "Predição",
    line = list(color = "blue"),
    marker = list(color = "blue")
  )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(obitos/9.55),
    type = 'scatter', mode = 'markers',
    name = "Real",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::layout(
    height = '380',
    yaxis = list(title = "Casos Confirmados por Milhão de Habitantes"),
    xaxis = list(title = "Data do Boletim"),
    hovermode = "compare"
  )
}
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p(paste('Modelagens Matemáticas - Leitos UTI', ''), style = "font-size: 125%; font-weight: bold;"))`

```{r}
plotly::plot_ly(base_predicao_leitos) %>% plotly::add_trace(x = ~data, y = ~leitos_uti_ocupado, type = 'scatter', mode = 'markers', name = "Leitos Ocupados - Real") %>% add_trace(
  x = ~data, 
  y = ceiling(predict(modelo4, base_predicao_leitos)), 
  name = "Leitos Ocupados - Estimado", mode = 'lines', line = list(width = 4)) %>% plotly::add_trace(
    x = ~data, 
    y = ~leitos_uti_disponivel, 
    name = "Leitos Disponíveis - Real", mode = 'markers') %>% layout(
    title = 'Predição de Leitos de UTI SRAG SUS em Pernambuco', 
    xaxis = list(title = 'Data', showgrid = FALSE), 
    yaxis = list(title = 'Leitos de UTI SRAG SUS Ocupados', showgrid = FALSE),
    hovermode = "compare")
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Predições | R0 (Número Básico de Reprodução) | Rt (Número Reprodutivo Efetivo)', style = "font-size: 115%;"))`

```{r}
valueBox('Macrorregião', color = 'purple')
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Modelagens Matemáticas', style = "font-size: 125%; font-weight: bold;"))`

```{r analises rt macro}

shiny::radioButtons(inputId = 'radioAn3', 'Modelo', c('Casos Totais', 'Rt'), inline = T)

selectizeInput('macro_rt', 'Macrorregiao', choices = sort(as.character(unique(confirmados_macro$macro))), selected = 'I - METROPOLITANA')

renderPlotly({

  if(input$radioAn3 == "Rt") {
   
  x <- confirmados_macro %>% filter(macro == input$macro_rt)
  
  macro_confirmados_rt <- x %>% compute_likelihood() %>% compute_posterior() %>% estimate_rt()

colnames(macro_confirmados_rt) <- c('data', 'rt', 'rt_min', 'rt_max')

p <- ggplot(macro_confirmados_rt, aes(y=rt, x=data)) + geom_line(colour = 'blue1', linetype = "dashed") + geom_point(colour = 'blue') + geom_ribbon(aes(ymin=rt_min, ymax=rt_max, x=data), alpha = 0.2) + scale_colour_manual("", values="blue") + scale_fill_manual("", values="blue1") + geom_hline(yintercept=1, linetype = "dashed")

fig <- ggplotly(p) %>%
  plotly::layout(
    height = '380',
    title = '',
    yaxis = list(title = "Rt - Número Reprodutivo Efetivo"),
    xaxis = list(title = ""),
    hovermode = "compare"
  )

fig
  }
  
  else {
   plotly::plot_ly(data = pred_ll_m1) %>%
  plotly::add_trace(
    x = ~data,
    y = ~ceiling(predicao),
    type = 'scatter', mode = 'lines',
    name = "Predição",
    line = list(color = "blue"),
    marker = list(color = "blue")
  )  %>%
  add_trace(
    x = ~data,
    y = ~ceiling(totalCases),
    type = 'scatter', mode = 'lines',
    name = "Real",
    line = list(color = "red"),
    marker = list(color = "red")
  ) %>%
  plotly::layout(
    title = 'MACRO I',
    height = '380',
    yaxis = list(title = "Casos Confirmados"),
    xaxis = list(title = "Data do Boletim"),
    hovermode = "compare"
  ) 
  }
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Predições | R0 (Número Básico de Reprodução) | Rt (Número Reprodutivo Efetivo)', style = "font-size: 115%;"))`

```{r}
valueBox('Geres', color = 'purple')
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Modelagens Matemáticas', style = "font-size: 125%; font-weight: bold;"))`

```{r analises rt geres}

selectizeInput('geres_rt', 'Geres', choices = sort(as.character(unique(confirmados_geres$geres))), selected = 'I GERES')

renderPlotly({
 
  x <- confirmados_geres %>% filter(geres == input$geres_rt)
  
  geres_confirmados_rt <- x %>% compute_likelihood() %>% compute_posterior() %>% estimate_rt()

colnames(geres_confirmados_rt) <- c('data', 'rt', 'rt_min', 'rt_max')

p <- ggplot(geres_confirmados_rt, aes(y=rt, x=data)) + geom_line(colour = 'blue1', linetype = "dashed") + geom_point(colour = 'blue') + geom_ribbon(aes(ymin=rt_min, ymax=rt_max, x=data), alpha = 0.2) + scale_colour_manual("", values="blue") + scale_fill_manual("", values="blue1") + geom_hline(yintercept=1, linetype = "dashed")

fig <- ggplotly(p) %>%
  plotly::layout(
    height = '380',
    title = '',
    yaxis = list(title = "Rt - Número Reprodutivo Efetivo"),
    xaxis = list(title = ""),
    hovermode = "compare"
  )

fig
})
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Predições | R0 (Número Básico de Reprodução) | Rt (Número Reprodutivo Efetivo)', style = "font-size: 115%;"))`

```{r}
valueBox('Município', color = 'purple')
```

Row
-------------------------------------

### `r valueBox(value =  tags$p('Modelagens Matemáticas', style = "font-size: 125%; font-weight: bold;"))`

```{r analises rt municipios}

selectizeInput('mun_rt', 'Município', choices = sort(as.character(unique(confirmados_mun_rt$municipio))), selected = 'RECIFE')

renderPlotly({
 
  x <- confirmados_mun_rt %>% filter(municipio == input$mun_rt)
  
  mun_confirmados_rt <- x %>% compute_likelihood() %>% compute_posterior() %>% estimate_rt()

colnames(mun_confirmados_rt) <- c('data', 'rt', 'rt_min', 'rt_max')

p <- ggplot(mun_confirmados_rt, aes(y=rt, x=data)) + geom_line(colour = 'blue1', linetype = "dashed") + geom_point(colour = 'blue') + geom_ribbon(aes(ymin=rt_min, ymax=rt_max, x=data), alpha = 0.2) + scale_colour_manual("", values="blue") + scale_fill_manual("", values="blue1") + geom_hline(yintercept=1, linetype = "dashed")

fig <- ggplotly(p) %>%
  plotly::layout(
    height = '380',
    title = '',
    yaxis = list(title = "Rt - Número Reprodutivo Efetivo"),
    xaxis = list(title = ""),
    hovermode = "compare"
  )

fig
})
```

Metadados {data-icon="fa-info" data-orientation=rows}
=====================================

Row
-------------------------------------

### Modelo de Predição de Casos e Óbitos

#### Como fizemos a predição de casos e de óbitos?

Com base em **curvas em S** (distribuições logísticas). Essas curvas foram utilizadas inicialmente para o estudo de crescimento populacional e depois para análise de sobrevivência, análise de medicamentos e doenças. Nesse caso, os cálculos são feitos para estimar três valores:
* **valor no ponto médio** ou ponto de inflexão, que é quando a curva muda de comportamento;
* **valor no ponto máximo**, que nos indica até onde a curva cresce e qual seria o valor máximo de óbitos, por exemplo; e 
* **inclinação da curva**, ou seja, o quão rápido a curva sobe nos seus diferentes trechos. 

Com esses três valores é possível montar toda a curva. Para calculá-los, usamos os dados de casos e óbitos que aconteceram ate então. Assim, é possível estimar os três valores e projetar a curva de casos e óbitos para dias na frente. Para deixar ainda mais preciso, na verdade, nos testamos diferentes versões e ajustes, procurando sempre aquele que mais se aproxima da curva original. Esse processo é refeito todos os dias, conforme novos dados são medidos e disponibilizados, para que assim tenhamos sempre uma predição mais precisa. 

#### Por que usamos essa metodologia para casos e óbitos? 
Com as **curvas S** e possível desenhar comportamentos que começam devagar e linear, passam para um crescimento exponencial, e terminam com a estabilização - daí seu nome, pois se parecem com  um *S*. Esse comportamento aproxima-se do comportamento do vírus, uma vez que há um limite para o total de pessoas que podem ser infectadas em um determinado lugar. Para epidemias, e preferível usar a versão log-logística ou a versão de Weibull, pois ambas lidam apenas com valores positivos - o que ajuda com as predições, já que no mundo real todos os dados analisados (tempo, confirmados, recuperados, óbitos, etc.) são positivos. Assim, a utilização de modelos da familia S permite ajustar diferentes fases de crescimento (devagar e linear, exponencial, devagar e estabilizando), estimando quando o evento terminará, e qual será seu valor. 

Row
-------------------------------------

### Modelo de Predição de Leitos

#### Como fizemos a predição de leitos ocupados de UTI SRAG SUS?

Com um *modelo dinâmico para séries temporais*. Isso quer dizer que o modelo usa os valores antigos de leitos ocupados na última semana para criar suas predições - por isso chamamos de dinâmico, pois usa o mesmo indicador no passado para predizer o futuro. Além disso, são usados indicadores auxiliares, como o total de casos srag na última semana e o total de óbitos srag na última semana. 

Então, com os valores históricos desses três indicadores - leitos ocupados uti srag sus, obitos srag e casos srag - e possível estimar a importância e o peso de cada indicador para o cálculo do número de leitos ocupados de uti srag sus na semana seguinte, e assim predizer os prováveis valores futuros dos leitos para uma semana na frente. 

Na tabela a seguir, vemos esses valores - peso e importância -, representados da seguinte forma: **peso** e o multiplicador, ou seja, se tivermos um peso de 0.5, isso indica que devemos dividir aquele indicador por 2 para obter o outro; **importância** é a importância absoluta, na escala original do seu teste de estimativa; e **importância relativa** é a importância em termos percentuais. Finalmente, sempre que o sufixo "_l7" aparecer, quer dizer que são usados na predição os valores de 7 dias atrás. 

```{r}
datatable(modelo4_importancia)
```

#### Por que usamos essa metodologia para leitos ocupados de UTI SRAG SUS?

Os dados de leitos de UTI ao longo do tempo apresentam um padrão de série temporal com tendência e sazonalidade. Tendência quer dizer que é possível observar se os dados estão tendendo a crescer, estacionar ou cair. Sazonalidade significa que, além de uma tendência geral, há repetições de altos e baixos em determinados dias da semana. Assim podemos usar esses dois padrões, tendência e sazonalidade, para predizer os valores do indicador na semana seguinte.

No caso da ocupação de leitos, é importante que o painel seja dinâmico e multivariado. Dinâmico tem o sentido de que, além dos valores de tendência e sazonalidade, deve-se usar valores o mesmo indicador - leitos ocupados de uti srag sus - com valores de dias anteriores. Nesse caso, usamos sempre de 7 dias atrás, pois esse indicador apresenta sazonalidade semanal, ou seja, se voce comparar as segundas-feiras da série temporal dos dados, vai encontrar padrões semelhantes. Já multivariado quer dizer que foram usados outros indicadores na predição - no caso, casos srag e óbitos srag. Esses indicadores auxiliares entram na equação para melhorá-lo e evitar que o modelo apenas repita os valores de ocupação de leitos de uma semana na seguinte. Com isso, temos um modelo robusto, que apresenta ótimo ajuste e baixo nível de erro.  

Row
-------------------------------------

### Modelo de Estimativa do Número Reprodutivo Efetivo (Rt)

#### Como fizemos a estimativa do Rt?
O Rt, ou número efetivo de reprodução, não pode ser medido diretamente. Por isso, são necessários métodos que permitam usar o número de infectados dia a dia para a estimativa, sobretudo no caso de doenças emergentes¹. A forma escolhida para fazer isso foi um método que usa a probabilidade primária de ocorrência de casos por dia revisada pela ocorrência real dos dados. Isso quer dizer que primeiro estimamos como seria a ocorrência de novos casos num modelo de distribuição teórica, e revisamos com a ocorrência dos dados, comparando as variações de um dia para o outro. Já que os dados diários variam bastante, de acordo com o padrão de busca pelo sistema de saúde, notificação e testagem, foi utilizada a média móvel de 7 dias (MM7) para aumentar a precisão na estimativa do Rt, seguindo os modelos testados por outros autores²³.

#### Por que usamos essa metodologia para Rt? 
O R0, ou número básico de reprodução, representa quantas infecções secundárias são produzidas por uma infecção inicial. O Rt, número reprodutivo efetivo, representa, dia após dia, quantas infecções são esperadas a partir de uma primeira infeção. Seu uso permite análises melhores para a política pública, já que sua variação responde a ações como isolamento, uso de máscaras, etc., pois não é a reprodução primária do vírus, mas, sim, sua reprodução efetiva, considerando o padrão observado nos dados. 

¹Real Time Bayesian Estimation of the Epidemic Potential of Emerging Infectious Diseases (2008). https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0002185

² The Metric We Need to Manage COVID-19 - Rt: the effective reproduction number (2020). http://systrom.com/blog/the-metric-we-need-to-manage-covid-19/

³ Serial Interval of COVID-19 among Publicly Reported Confirmed Cases (2020). https://wwwnc.cdc.gov/eid/article/26/6/20-0357_article
